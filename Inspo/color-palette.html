<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MultiFactor Solutions - Color Palette Editor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #000000;
      color: #ffffff;
      padding: 60px 40px;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 60px;
      flex-wrap: wrap;
      gap: 24px;
    }

    h1 {
      font-size: 48px;
      font-weight: 900;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #26e5a4 0%, #3b82f6 50%, #8b5cf6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .subtitle {
      font-size: 18px;
      color: #999;
    }

    .header-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn:hover {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.2);
    }

    .btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .btn:disabled:hover {
      background: rgba(255,255,255,0.06);
      border-color: rgba(255,255,255,0.1);
    }

    .btn-primary {
      background: linear-gradient(135deg, rgba(38,229,164,0.2), rgba(38,229,164,0.1));
      border: 1px solid rgba(38,229,164,0.4);
      color: #26e5a4;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, rgba(38,229,164,0.3), rgba(38,229,164,0.15));
    }

    .section {
      margin-bottom: 80px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .section-title {
      font-size: 32px;
      font-weight: 800;
      color: #fff;
    }

    .color-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
    }

    .color-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      overflow: hidden;
      transition: all 0.3s;
      position: relative;
    }

    .color-card:hover {
      transform: translateY(-4px);
      border-color: rgba(255, 255, 255, 0.15);
    }

    .color-card:hover .card-actions {
      opacity: 1;
    }

    .card-actions {
      position: absolute;
      top: 12px;
      right: 12px;
      display: flex;
      gap: 6px;
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 10;
    }

    .card-action-btn {
      width: 32px;
      height: 32px;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 6px;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .card-action-btn:hover {
      background: rgba(255,255,255,0.15);
    }

    .card-action-btn.delete {
      color: #ef4444;
      border-color: rgba(239,68,68,0.3);
    }

    .card-action-btn.delete:hover {
      background: rgba(239,68,68,0.2);
    }

    .color-swatch {
      height: 160px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      font-weight: 700;
      text-shadow: 0 2px 8px rgba(0,0,0,0.5);
      cursor: pointer;
      position: relative;
    }

    .color-swatch::after {
      content: 'Click to edit color';
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      padding: 4px 12px;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(10px);
      border-radius: 4px;
      font-size: 11px;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .color-swatch:hover::after {
      opacity: 1;
    }

    .color-info {
      padding: 20px;
    }

    .color-name {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 8px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background 0.2s;
    }

    .color-name:hover {
      background: rgba(255,255,255,0.05);
    }

    .color-name[contenteditable="true"] {
      outline: 1px solid rgba(38,229,164,0.3);
      background: rgba(38,229,164,0.05);
    }

    .color-codes {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .color-code {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 8px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .color-code:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(255, 255, 255, 0.12);
    }

    .color-code.copied {
      background: rgba(38,229,164,0.1);
      border-color: rgba(38,229,164,0.3);
    }

    .code-label {
      color: #666;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .code-value {
      color: #e5e5e5;
      font-weight: 600;
    }

    .usage-note {
      margin-top: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.02);
      border-left: 3px solid;
      border-radius: 4px;
      font-size: 13px;
      line-height: 1.6;
      color: #999;
      cursor: pointer;
      transition: background 0.2s;
    }

    .usage-note:hover {
      background: rgba(255, 255, 255, 0.04);
    }

    .usage-note[contenteditable="true"] {
      outline: 1px solid rgba(38,229,164,0.3);
      background: rgba(38,229,164,0.05);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: rgba(10,10,12,0.95);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      padding: 32px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 24px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #999;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .form-input, .form-textarea {
      width: 100%;
      padding: 12px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
      font-family: inherit;
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
    }

    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: rgba(38,229,164,0.4);
      background: rgba(38,229,164,0.05);
    }

    .color-picker-wrapper {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .color-picker-input {
      width: 80px;
      height: 80px;
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      cursor: pointer;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 16px 24px;
      background: rgba(38,229,164,0.9);
      border: 1px solid rgba(38,229,164,1);
      border-radius: 8px;
      color: #000;
      font-weight: 600;
      font-size: 14px;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
      z-index: 2000;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .hint {
      margin-top: 32px;
      padding: 20px;
      background: rgba(38,229,164,0.05);
      border: 1px solid rgba(38,229,164,0.2);
      border-radius: 12px;
      font-size: 14px;
      color: #999;
      line-height: 1.7;
    }

    .hint strong {
      color: #26e5a4;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1>MultiFactor Solutions</h1>
        <p class="subtitle">Interactive Color Palette Editor</p>
      </div>
      <div class="header-actions">
        <button class="btn" id="undoBtn" onclick="undo()" disabled>
          ‚Ü∂ Undo
        </button>
        <button class="btn" id="redoBtn" onclick="redo()" disabled>
          ‚Ü∑ Redo
        </button>
        <button class="btn" onclick="resetToDefaults()">
          üîÑ Reset All
        </button>
        <button class="btn" onclick="exportCSS()">
          üìÑ Export CSS
        </button>
        <button class="btn" onclick="exportJSON()">
          üì¶ Export JSON
        </button>
      </div>
    </div>

    <div class="hint">
      <strong>‚ú® Fully Interactive!</strong><br>
      ‚Ä¢ <strong>Click any color swatch</strong> to change the color<br>
      ‚Ä¢ <strong>Click color names</strong> to edit them<br>
      ‚Ä¢ <strong>Click usage notes</strong> to edit descriptions<br>
      ‚Ä¢ <strong>Click any color code</strong> to copy to clipboard<br>
      ‚Ä¢ <strong>Add new colors</strong> with the + buttons<br>
      ‚Ä¢ <strong>Delete colors</strong> with the trash icon (appears on hover)<br>
      ‚Ä¢ <strong>Reset individual colors</strong> with the ‚Ü∂ icon (appears on hover)<br>
      ‚Ä¢ <strong>Undo/Redo</strong> any changes with the buttons at the top<br>
      ‚Ä¢ <strong>Gradients are back!</strong> Click gradient swatches to edit CSS<br>
      ‚Ä¢ All changes auto-save to your browser!
    </div>

    <!-- Colors will be rendered here -->
    <div id="colorSections"></div>

    <!-- Add New Color Modal -->
    <div id="addColorModal" class="modal">
      <div class="modal-content">
        <h2 class="modal-title">Add New Color</h2>
        <div class="form-group">
          <label class="form-label">Color Name</label>
          <input type="text" id="newColorName" class="form-input" placeholder="e.g., Primary Green">
        </div>
        <div class="form-group">
          <label class="form-label">Color</label>
          <div class="color-picker-wrapper">
            <input type="color" id="newColorPicker" class="color-picker-input" value="#26e5a4">
            <input type="text" id="newColorHex" class="form-input" placeholder="#26e5a4" value="#26e5a4">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Usage Description</label>
          <textarea id="newColorUsage" class="form-textarea" placeholder="Describe when to use this color..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Section</label>
          <input type="text" id="newColorSection" class="form-input" placeholder="e.g., Brand Colors">
        </div>
        <div class="modal-actions">
          <button class="btn btn-primary" style="flex: 1;" onclick="saveNewColor()">Add Color</button>
          <button class="btn" onclick="closeModal()">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>
  </div>

  <script>
    // Default color palette
    const defaultPalette = {
      "Brand Colors": [
        { name: "Primary (Teal)", hex: "#26e5a4", usage: "Protocol branding, success states, primary CTA buttons, active indicators" },
        { name: "Tertiary (Blue)", hex: "#3b82f6", usage: "MF-ClinRef branding, PK curves, informational elements, data visualization" },
        { name: "Secondary (Purple)", hex: "#8b5cf6", usage: "Amore branding, AI features, premium indicators, accent highlights" }
      ],
      "Semantic Colors": [
        { name: "Error / Warning (Red)", hex: "#ef4444", usage: "Dosing warnings, critical alerts, error states, 48-hour dose alerts" },
        { name: "Caution (Yellow)", hex: "#fbbf24", usage: "Hydration reminders, prep alerts, attention-needed states" },
        { name: "Success (Green)", hex: "#22c55e", usage: "Success messages, completed states, positive indicators" }
      ],
      "Signature Gradients": [
        { name: "Full Brand Spectrum", gradient: "linear-gradient(135deg, #26e5a4 0%, #3b82f6 50%, #8b5cf6 100%)", usage: "MF Solution text, hero elements, brand moments" },
        { name: "Protocol Teal-Cyan", gradient: "linear-gradient(135deg, #26e5a4 0%, #5de4ff 100%)", usage: "Protocol signature gradient, teal-to-cyan text effects, accent highlights" },
        { name: "Problem Gradient", gradient: "linear-gradient(135deg, #ff3b3b 0%, #ff8f3b 100%)", usage: "another problem. text in hero tagline" },
        { name: "Metallic Silver", gradient: "linear-gradient(135deg, #ffffff 0%, #94a3b8 100%)", usage: "Healthcare text in hero tagline" }
      ],
      "Backgrounds": [
        { name: "Base Background", hex: "#000000", usage: "Primary page background, main canvas color" },
        { name: "Card Background", hex: "#050507", usage: "App mockup containers, floating cards, primary UI surfaces" },
        { name: "Surface (Glass)", hex: "#0a0a0c", usage: "Glass morphism cards, bento grid items, floating elements" }
      ],
      "Text Colors": [
        { name: "Primary Text", hex: "#ffffff", usage: "Headings, titles, primary content, high-emphasis text" },
        { name: "Body Text", hex: "#e5e5e5", usage: "Body copy, descriptions, medium-emphasis text" },
        { name: "Secondary Text", hex: "#999999", usage: "Subtitles, captions, helper text, low-emphasis content" },
        { name: "Muted Text", hex: "#666666", usage: "Labels, placeholders, timestamps, very low-emphasis text" }
      ]
    };

    // Load palette from localStorage or use defaults
    let palette = JSON.parse(localStorage.getItem('colorPalette')) || defaultPalette;
    
    // Version check - update Signature Gradients if outdated (v2 = 4 gradients)
    const currentGradientsVersion = 2;
    const savedVersion = localStorage.getItem('gradientsVersion') || 1;
    
    if (savedVersion < currentGradientsVersion) {
      console.log('Updating gradients to v2 (adding Protocol Teal-Cyan)');
      palette["Signature Gradients"] = JSON.parse(JSON.stringify(defaultPalette["Signature Gradients"]));
      localStorage.setItem('gradientsVersion', currentGradientsVersion);
    }
    
    // Smart merge: Add any missing sections from defaults
    Object.keys(defaultPalette).forEach(section => {
      if (!palette[section]) {
        palette[section] = JSON.parse(JSON.stringify(defaultPalette[section]));
        console.log(`Added missing section: ${section}`);
      }
    });
    
    // Save merged palette
    localStorage.setItem('colorPalette', JSON.stringify(palette));
    
    // Undo/Redo system
    let history = [];
    let historyIndex = -1;
    const MAX_HISTORY = 50;

    function saveToHistory() {
      // Remove any history after current index
      history = history.slice(0, historyIndex + 1);
      // Add new state
      history.push(JSON.parse(JSON.stringify(palette)));
      // Limit history size
      if (history.length > MAX_HISTORY) {
        history.shift();
      } else {
        historyIndex++;
      }
      updateUndoButtons();
    }

    function undo() {
      if (historyIndex > 0) {
        historyIndex--;
        palette = JSON.parse(JSON.stringify(history[historyIndex]));
        savePalette();
        renderPalette();
        updateUndoButtons();
        showToast('Undone!');
      }
    }

    function redo() {
      if (historyIndex < history.length - 1) {
        historyIndex++;
        palette = JSON.parse(JSON.stringify(history[historyIndex]));
        savePalette();
        renderPalette();
        updateUndoButtons();
        showToast('Redone!');
      }
    }

    function updateUndoButtons() {
      const undoBtn = document.getElementById('undoBtn');
      const redoBtn = document.getElementById('redoBtn');
      if (undoBtn) undoBtn.disabled = historyIndex <= 0;
      if (redoBtn) redoBtn.disabled = historyIndex >= history.length - 1;
    }

    // Initialize history
    saveToHistory();

    // Render the palette
    function renderPalette() {
      const container = document.getElementById('colorSections');
      container.innerHTML = '';

      Object.keys(palette).forEach(section => {
        const sectionDiv = document.createElement('div');
        sectionDiv.className = 'section';
        
        sectionDiv.innerHTML = `
          <div class="section-header">
            <h2 class="section-title">${section}</h2>
            <button class="btn btn-primary" onclick="openAddModal('${section}')">
              + Add Color
            </button>
          </div>
          <div class="color-grid" id="grid-${section.replace(/\s/g, '-')}"></div>
        `;
        
        container.appendChild(sectionDiv);

        // Render colors in this section
        const grid = document.getElementById(`grid-${section.replace(/\s/g, '-')}`);
        palette[section].forEach((color, index) => {
          grid.appendChild(createColorCard(color, section, index));
        });
      });
    }

    // Create a color card
    function createColorCard(color, section, index) {
      const card = document.createElement('div');
      card.className = 'color-card';
      
      const isGradient = !!color.gradient;
      const displayValue = isGradient ? color.gradient : color.hex;
      const rgb = isGradient ? '' : hexToRgb(color.hex);
      const borderColor = isGradient ? '#8b5cf6' : color.hex;
      const textColor = isGradient ? '#ffffff' : getContrastColor(color.hex);

      card.innerHTML = `
        <div class="card-actions">
          <div class="card-action-btn" onclick="resetSingleColor('${section}', ${index})" title="Reset to default">
            ‚Ü∂
          </div>
          <div class="card-action-btn delete" onclick="deleteColor('${section}', ${index})" title="Delete">
            üóëÔ∏è
          </div>
        </div>
        <div class="color-swatch" style="background: ${displayValue}; color: ${textColor};" 
             onclick="${isGradient ? `editGradient('${section}', ${index})` : `editColor('${section}', ${index})`}">
          ${isGradient ? 'Gradient' : color.hex}
        </div>
        <div class="color-info">
          <div class="color-name" contenteditable="true" 
               onblur="updateColorName('${section}', ${index}, this.textContent)">${color.name}</div>
          <div class="color-codes">
            ${isGradient ? `
              <div class="color-code" onclick="copyToClipboard('${color.gradient.replace(/'/g, "\\'")}', this)">
                <span class="code-label">CSS</span>
                <span class="code-value" style="font-size: 11px; overflow: hidden; text-overflow: ellipsis;">gradient</span>
              </div>
            ` : `
              <div class="color-code" onclick="copyToClipboard('${color.hex}', this)">
                <span class="code-label">HEX</span>
                <span class="code-value">${color.hex}</span>
              </div>
              <div class="color-code" onclick="copyToClipboard('${rgb}', this)">
                <span class="code-label">RGB</span>
                <span class="code-value">${rgb}</span>
              </div>
            `}
          </div>
          <div class="usage-note" style="border-color: ${borderColor};" contenteditable="true"
               onblur="updateColorUsage('${section}', ${index}, this.textContent)">
            ${color.usage}
          </div>
        </div>
      `;

      return card;
    }

    // Edit color with color picker
    function editColor(section, index) {
      const input = document.createElement('input');
      input.type = 'color';
      input.value = palette[section][index].hex;
      input.onchange = (e) => {
        saveToHistory();
        palette[section][index].hex = e.target.value;
        savePalette();
        renderPalette();
        showToast('Color updated!');
      };
      input.click();
    }

    // Edit gradient
    function editGradient(section, index) {
      const newGradient = prompt('Enter CSS gradient:', palette[section][index].gradient);
      if (newGradient && newGradient.trim()) {
        saveToHistory();
        palette[section][index].gradient = newGradient.trim();
        savePalette();
        renderPalette();
        showToast('Gradient updated!');
      }
    }

    // Reset single color to default
    function resetSingleColor(section, index) {
      if (!defaultPalette[section] || !defaultPalette[section][index]) {
        showToast('No default value for this color');
        return;
      }
      if (confirm('Reset this color to default?')) {
        saveToHistory();
        palette[section][index] = JSON.parse(JSON.stringify(defaultPalette[section][index]));
        savePalette();
        renderPalette();
        showToast('Color reset to default!');
      }
    }

    // Update color name
    function updateColorName(section, index, newName) {
      saveToHistory();
      palette[section][index].name = newName;
      savePalette();
    }

    // Update color usage
    function updateColorUsage(section, index, newUsage) {
      saveToHistory();
      palette[section][index].usage = newUsage;
      savePalette();
    }

    // Delete color
    function deleteColor(section, index) {
      if (confirm('Delete this color?')) {
        saveToHistory();
        palette[section].splice(index, 1);
        if (palette[section].length === 0) {
          delete palette[section];
        }
        savePalette();
        renderPalette();
        showToast('Color deleted!');
      }
    }

    // Open add modal
    function openAddModal(section = '') {
      document.getElementById('newColorSection').value = section;
      document.getElementById('newColorName').value = '';
      document.getElementById('newColorPicker').value = '#26e5a4';
      document.getElementById('newColorHex').value = '#26e5a4';
      document.getElementById('newColorUsage').value = '';
      document.getElementById('addColorModal').classList.add('active');
      
      // Sync color picker and hex input
      document.getElementById('newColorPicker').oninput = (e) => {
        document.getElementById('newColorHex').value = e.target.value;
      };
      document.getElementById('newColorHex').oninput = (e) => {
        if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
          document.getElementById('newColorPicker').value = e.target.value;
        }
      };
    }

    // Close modal
    function closeModal() {
      document.getElementById('addColorModal').classList.remove('active');
    }

    // Save new color
    function saveNewColor() {
      const section = document.getElementById('newColorSection').value.trim() || 'Custom Colors';
      const name = document.getElementById('newColorName').value.trim() || 'Untitled Color';
      const hex = document.getElementById('newColorHex').value.trim();
      const usage = document.getElementById('newColorUsage').value.trim() || 'No description provided';

      if (!/^#[0-9A-F]{6}$/i.test(hex)) {
        alert('Please enter a valid hex color (e.g., #26e5a4)');
        return;
      }

      saveToHistory();
      
      if (!palette[section]) {
        palette[section] = [];
      }

      palette[section].push({ name, hex, usage });
      savePalette();
      renderPalette();
      closeModal();
      showToast('Color added!');
    }

    // Save palette to localStorage
    function savePalette() {
      localStorage.setItem('colorPalette', JSON.stringify(palette));
    }

    // Reset to defaults
    function resetToDefaults() {
      if (confirm('Reset ALL colors to defaults? This will delete all custom colors and changes.')) {
        saveToHistory();
        palette = JSON.parse(JSON.stringify(defaultPalette));
        savePalette();
        renderPalette();
        showToast('Reset to defaults!');
      }
    }

    // Export as CSS
    function exportCSS() {
      let css = ':root {\n';
      Object.values(palette).flat().forEach((color, i) => {
        const varName = color.name.toLowerCase().replace(/[^a-z0-9]/g, '-');
        css += `  --color-${varName}: ${color.hex};\n`;
      });
      css += '}\n';

      downloadFile('colors.css', css);
      showToast('CSS exported!');
    }

    // Export as JSON
    function exportJSON() {
      const json = JSON.stringify(palette, null, 2);
      downloadFile('colors.json', json);
      showToast('JSON exported!');
    }

    // Download file
    function downloadFile(filename, content) {
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    // Copy to clipboard
    function copyToClipboard(text, element) {
      navigator.clipboard.writeText(text).then(() => {
        element.classList.add('copied');
        setTimeout(() => element.classList.remove('copied'), 300);
        showToast(`Copied: ${text}`);
      });
    }

    // Show toast
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // Helper: hex to RGB
    function hexToRgb(hex) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return `${r}, ${g}, ${b}`;
    }

    // Helper: get contrasting text color
    function getContrastColor(hex) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      const brightness = (r * 299 + g * 587 + b * 114) / 1000;
      return brightness > 128 ? '#000000' : '#ffffff';
    }

    // Close modal on outside click
    document.getElementById('addColorModal').addEventListener('click', (e) => {
      if (e.target.id === 'addColorModal') closeModal();
    });

    // Initial render
    renderPalette();
  </script>
</body>
</html>
